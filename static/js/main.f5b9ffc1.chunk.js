(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{231:function(e,t,a){e.exports=a(296)},236:function(e,t,a){},296:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(11),c=a.n(i),o=(a(236),a(84)),l=a(52),s=a(214),u=a.n(s),m=a(225),p=a(21),d=!1,f=function(e,t){switch(t.type){case"setLines":d=!0;var a=t.data.LinesDelivery.AnnotatedLineRef.map(function(e){return{LineRef:e.LineRef,LineName:e.LineName,RouteType:e.Extension.RouteType}});return e.stops.length>0&&(d=!1),Object(p.a)({},e,{lines:a,loading:d});case"setStops":d=!0;var n=[],r={};return t.data.ServiceDelivery.EstimatedTimetableDelivery.map(function(e){return e.EstimatedJourneyVersionFrame.map(function(e){return e.EstimatedVehicleJourney.map(function(e){var t=e.LineRef,a=e.DirectionRef,i=e.Extension.VehicleMode;return e.EstimatedCalls.map(function(e){return!r[e.StopPointRef]&&(n.push({LineRef:t,DirectionRef:a,StopPointRef:e.StopPointRef,StopPointName:e.StopPointName,DestinationName:e.DestinationName,VehicleMode:i}),r[e.StopPointRef]=!0,!1)}),!1}),!1}),!1}),e.lines.length>0&&(d=!1),Object(p.a)({},e,{stops:n,loading:d});case"VehicleModeFilter":var i=e.VehicleMode;return i[t.data.mode]=t.data.checked,Object(p.a)({},e,{VehicleMode:i});case"LineSelection":return Object(p.a)({},e,{line:t.data.line});case"StopSelection":return Object(p.a)({},e,{stop:t.data.stop});case"DateSelection":return Object(p.a)({},e,{date:t.data.date});case"Search":var c=[];return"undefined"===typeof t.data.ServiceDelivery.StopMonitoringDelivery[0].MonitoredStopVisit?Object(p.a)({},e,{results:c}):(t.data.ServiceDelivery.StopMonitoringDelivery[0].MonitoredStopVisit.map(function(e){var t=e.MonitoredVehicleJourney,a=t.MonitoredCall;return c.push({DestinationName:t.DestinationName,LineRef:t.LineRef,VehicleMode:t.VehicleMode,IsRealTime:a.Extension.IsRealTime,StopPointName:a.StopPointName,ExpectedArrivalTime:a.ExpectedArrivalTime,ExpectedDepartureTime:a.ExpectedDepartureTime}),!1}),Object(p.a)({},e,{results:c,loading:!1}));case"maxStopArrivalsSelection":return Object(p.a)({},e,{maxStopArrivals:t.data.maxStopArrivals});case"loading":return Object(p.a)({},e,{loading:!0});case"routeParams":return void 0!==t.data.match.params.stop?Object(p.a)({},e,{VehicleMode:{bus:JSON.parse(t.data.match.params.bus),tram:JSON.parse(t.data.match.params.tram)},line:t.data.match.params.line,stop:t.data.match.params.stop}):Object(p.a)({},e);case"loadResult":return void 0!==t.data.match.params.stop&&t.data.load(t.data.match.params.stop,t.data.match.params.line,e.date,e.maxStopArrivals),Object(p.a)({},e);case"setLinesFromCache":return e.stops.length>0&&(d=!1),Object(p.a)({},e,{lines:t.data,loading:d});case"setStopsFromCache":return e.lines.length>0&&(d=!1),Object(p.a)({},e,{stops:t.data,loading:d});default:throw new Error}},h=Object(n.createContext)({}),v=function(e){var t=e.children,a=e.initialState,i=Object(n.useReducer)(f,a),c=Object(m.a)(i,2),o={state:c[0],dispatch:c[1]};return r.a.createElement(h.Provider,{value:o},t)},E=a(29),b=a.n(E),y=a(44),j=a(105),x=a.n(j),g=x.a.create({baseURL:"https://api.cts-strasbourg.eu/v1/siri/2.0/"}),O=function(e,t){return g.get(e,{params:t.params,auth:{username:"27fc0b07-5e85-41de-a749-338e1a00e4e8"}}).then(function(e){var a=e.data;t.dispatch({type:t.type,data:a})}).catch(function(e){alert(e)})},S=function(){var e=Object(y.a)(b.a.mark(function e(t){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O("lines-discovery",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(y.a)(b.a.mark(function e(t){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O("estimated-timetable",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),R=x.a.create({baseURL:"/cts-2019/cache/"}),w=function(e,t){return R.get(e,{params:t.params}).then(function(e){var a=e.data;t.dispatch({type:t.type,data:a})}).catch(function(e){alert(e)})},L=function(){var e=Object(y.a)(b.a.mark(function e(t){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("lines.json",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(y.a)(b.a.mark(function e(t){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("stops.json",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=a(157),C=a(193),T=a(212),V=function(){var e=Object(n.useContext)(h),t=e.state.VehicleMode,a=e.dispatch,i=function(e){return function(t){a({type:"VehicleModeFilter",data:{mode:e,checked:t.target.checked}})}};return r.a.createElement("div",null,r.a.createElement(k.a,{component:"legend"},"Type de transport"),r.a.createElement(C.a,{control:r.a.createElement(T.a,{checked:t.bus,onChange:i("bus"),value:"bus",color:"primary"}),label:"Bus"}),r.a.createElement(C.a,{control:r.a.createElement(T.a,{checked:t.tram,onChange:i("tram"),value:"tram",color:"primary"}),label:"Tram"}))},N=a(124),P=function(){var e=Object(n.useContext)(h),t=e.state,a=t.lines,i=t.line,c=t.VehicleMode,o=e.dispatch,l=a.filter(function(e){return!!c[e.RouteType]}).map(function(e){return{value:e.LineRef,label:e.RouteType+" "+e.LineRef+" - "+e.LineName}}),s=l.find(function(e){return e.value===i}),u={menu:function(e){return Object(p.a)({},e,{zIndex:999})}};return r.a.createElement("div",null,r.a.createElement(k.a,{component:"legend"},"Ligne"),r.a.createElement(N.a,{value:s,onChange:function(e){o({type:"LineSelection",data:{line:e.value}})},options:l,styles:u}))},A=function(){var e=Object(n.useContext)(h),t=e.state,a=t.stops,i=t.stop,c=t.line,o=e.dispatch,l=a.filter(function(e){return e.LineRef===c}).map(function(e){return{value:e.StopPointRef,label:e.VehicleMode+" "+e.LineRef+" - "+e.StopPointName+" => "+e.DestinationName}}),s=l.find(function(e){return e.value===i}),u={menu:function(e){return Object(p.a)({},e,{zIndex:999})}},m="";return l.length>0&&(m=r.a.createElement("div",null,r.a.createElement(k.a,{component:"legend"},"Arr\xeat"),r.a.createElement(N.a,{value:s,onChange:function(e){o({type:"StopSelection",data:{stop:e.value}})},options:l,styles:u}))),r.a.createElement("div",null,m)},I=a(224),F=a(217),J=a.n(F),U=a(177),Y=a(197),H=a(195),z=a(115),B=a(116),W=function(){var e=Object(n.useContext)(h),t=e.state,a=t.date,i=t.stop,c=e.dispatch;return null===i?r.a.createElement("div",null):r.a.createElement("div",null,r.a.createElement(k.a,{component:"legend"},"Horaire"),r.a.createElement(H.a,{container:!0,justify:"center",spacing:2},r.a.createElement(H.a,{key:"MuiPickersUtilsProvider",item:!0,xs:6},r.a.createElement(U.a,{utils:I.a,locale:J.a},r.a.createElement(U.b,{id:"mui-pickers-time",ampm:!1,variant:"inline",value:a,onChange:function(e){c({type:"DateSelection",data:{date:e}})}}))),r.a.createElement(H.a,{key:"button",item:!0,xs:6},r.a.createElement(Y.a,{variant:"contained",color:"primary",onClick:function(){c({type:"DateSelection",data:{date:new Date}})}},r.a.createElement(z.a,{icon:B.b})))))},$=Object(l.f)(function(e){var t=e.history,a=Object(n.useContext)(h),i=a.state,c=i.stop,o=i.line,l=i.VehicleMode,s=a.dispatch;return null===c?r.a.createElement("div",null):r.a.createElement(Y.a,{variant:"contained",color:"primary",onClick:function(){s({type:"loading"}),t.push("/"+l.bus+"/"+l.tram+"/"+o+"/"+c)}},"Rechercher")}),q=a(219),G=a.n(q),K=a(208),Q=a(53),X=a.n(Q),Z=a(222),_=a(76),ee=a(227),te=a(223),ae=a(226),ne=function(e){function t(e){var a;return Object(Z.a)(this,t),(a=Object(ee.a)(this,Object(te.a)(t).call(this,e))).dateUpdate=function(){a.setState({visibleDate:a.calculate()})},a.calculate=function(){var e=a.date.diff(X()());return e<0?a.props.finishedText:X.a.utc(e).format("HH:mm:ss")},a.date=X()(e.date),a.intervalId=null,a.state={visibleDate:a.calculate()},a}return Object(ae.a)(t,e),Object(_.a)(t,[{key:"componentDidUpdate",value:function(){this.date=X()(this.props.date)}},{key:"componentDidMount",value:function(){this.intervalId=setInterval(this.dateUpdate,1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.visibleDate)}}]),t}(n.Component),re=function(){var e=Object(n.useContext)(h).state,t=e.results,a=e.stop,i={filter:!1,search:!1,print:!1,download:!1,viewColumns:!1,selectableRows:"none",rowsPerPage:100,customFooter:function(e,t,a,n,i){return r.a.createElement(K.a,null)}},c=t.map(function(e){return[e.VehicleMode+" "+e.LineRef,e.StopPointName,e.DestinationName,!0===e.IsRealTime?"Oui":"Non",X()(e.ExpectedArrivalTime).format("DD/MM/YYYY HH:mm:ss"),X()(e.ExpectedDepartureTime).format("DD/MM/YYYY HH:mm:ss"),r.a.createElement(ne,{date:e.ExpectedArrivalTime,finishedText:"Arriv\xe9"}),r.a.createElement(ne,{date:e.ExpectedDepartureTime,finishedText:"Pass\xe9"})]});return 0===t.length?null!=a?r.a.createElement("div",null,"Pas de r\xe9sultat."):r.a.createElement("div",null):r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement(G.a,{title:"Liste des horaires",data:c,columns:["Ligne","Arr\xeat","Destination","Temps r\xe9el","Arriv\xe9e","D\xe9part","Arriv\xe9e dans","D\xe9part dans"],options:i}))},ie=a(311),ce=Object(ie.a)(function(e){return Object(n.useContext)(h).state.loading?r.a.createElement(z.a,{icon:B.a,pulse:!0,size:"4x",color:e.theme.palette.primary.main}):r.a.createElement("div",null)}),oe=a(117),le=a(196),se=function(){var e=Object(y.a)(b.a.mark(function e(t){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O("stop-monitoring",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),ue=Object(le.a)(function(e){return{root:{padding:e.spacing(3,2)}}}),me=Object(l.f)(function(e){var t=e.match,a=ue(),i=Object(n.useContext)(h).dispatch;return Object(n.useEffect)(function(){i({type:"routeParams",data:{match:t}}),i({type:"loadResult",data:{match:t,load:function(e,t,a,n){se({dispatch:i,type:"Search",params:{MonitoringRef:e,LineRef:t,StartTime:a,MaximumStopVisits:n}})}}})},[i,t]),r.a.createElement(oe.a,{className:a.root},r.a.createElement(H.a,{container:!0,spacing:2},r.a.createElement(H.a,{item:!0,xs:12},r.a.createElement(H.a,{container:!0,justify:"center",spacing:2},r.a.createElement(H.a,{key:"VehicleModeFilter",item:!0,xs:6},r.a.createElement(V,null)),r.a.createElement(H.a,{key:"DateSelection",item:!0,xs:6},r.a.createElement(W,null))),r.a.createElement(H.a,{container:!0,justify:"center",spacing:2},r.a.createElement(H.a,{key:"LineSelection",item:!0,xs:12},r.a.createElement(P,null))),r.a.createElement(H.a,{container:!0,justify:"center",spacing:2},r.a.createElement(H.a,{key:"LineSelection",item:!0,xs:12},r.a.createElement(A,null))),r.a.createElement(H.a,{container:!0,justify:"center",spacing:2},r.a.createElement(H.a,{key:"LineSelection",item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement($,null))),r.a.createElement(H.a,{container:!0,justify:"center",spacing:2},r.a.createElement(H.a,{key:"LineSelection",item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(ce,null))))),r.a.createElement(re,null))}),pe=a(103),de=Object(pe.a)({}),fe=a(310),he=Object(l.f)(function(e){var t=e.location,a=Object(n.useContext)(h).dispatch;console.log(t);var i=u.a.parse(t.search).nocache;return Object(n.useEffect)(function(){a({type:"loading"}),"undefined"!==typeof i?(S({dispatch:a,type:"setLines",params:{}}),D({dispatch:a,type:"setStops",params:{}})):(L({dispatch:a,type:"setLinesFromCache",params:{}}),M({dispatch:a,type:"setStopsFromCache",params:{}}))},[a,i]),r.a.createElement(me,null)}),ve=function(){var e={lines:[],stops:[],VehicleMode:{bus:!0,tram:!0},line:null,stop:null,date:new Date,results:[],maxStopArrivals:5,loading:!1};return r.a.createElement(fe.a,{theme:de},r.a.createElement(v,{initialState:e},r.a.createElement(he,null)))},Ee=function(e){var t=e.json,a=e.filename,n=e.label;if("{}"===t)return r.a.createElement("div",null);var i="data:application/json;charset=utf-8,"+encodeURIComponent(t);return r.a.createElement(Y.a,{href:i,download:a,color:"primary",variant:"contained"},n)},be=function(){var e=Object(n.useContext)(h).state.lines,t=JSON.stringify(e);return r.a.createElement(Ee,{label:"lignes",json:t,filename:"lines.json"})},ye=function(){var e=Object(n.useContext)(h).state.stops,t=JSON.stringify(e);return r.a.createElement(Ee,{label:"Stops",json:t,filename:"stops.json"})},je=Object(le.a)(function(e){return{root:{padding:e.spacing(3,2)}}}),xe=function(){var e=je(),t=Object(n.useContext)(h).dispatch;return Object(n.useEffect)(function(){S({dispatch:t,type:"setLines",params:{}}),D({dispatch:t,type:"setStops",params:{}})},[t]),r.a.createElement(H.a,{container:!0,spacing:2,className:e.root},r.a.createElement(H.a,{item:!0,xs:12},r.a.createElement(be,null)),r.a.createElement(H.a,{item:!0,xs:12},r.a.createElement(ye,null)))},ge=function(){var e={lines:[],stops:[],VehicleMode:{bus:!0,tram:!0},line:null,stop:null,date:new Date,results:[],maxStopArrivals:5,loading:!1};return r.a.createElement(v,{initialState:e},r.a.createElement(xe,null))};var Oe=function(){return r.a.createElement(o.a,{basename:"/cts-2019"},r.a.createElement(l.c,null,r.a.createElement(l.a,{exact:!0,path:"/admin/lines",component:ge}),r.a.createElement(l.a,{exact:!0,path:"/:bus?/:tram?/:line?/:stop?",component:ve})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[231,1,2]]]);
//# sourceMappingURL=main.f5b9ffc1.chunk.js.map